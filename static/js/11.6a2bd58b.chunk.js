(this["webpackJsonpsgn-explorer"]=this["webpackJsonpsgn-explorer"]||[]).push([[11],{1133:function(e,t,r){"use strict";r.r(t);var a=r(32),i=r(17),s=r(1),n=r.n(s),c=r(0),o=r.n(c),d=r(65),l=r.n(d),h=r(90),u=r(914),w=r(77),v=r(1132),m=r(1137),j=r(1128),p=r(1129),g=r(1013),b=r(957),R=r.n(b),O=r(927),S="init",x="wait",f="redeem";class y extends n.a.Component{constructor(e,t){super(e),this.intendWithdraw=()=>{this.gateway.post("/validator/withdrawReward",{eth_addr:this.currentUser}).then((()=>{u.a.success("Success! Please wait a few seconds to trigger redeem."),this.waitSigs()})).catch((e=>{console.error(e)}))},this.waitSigs=()=>{this.setState({action:x,waitTime:30}),this.interval=setInterval((()=>{var e=this.state.waitTime;if(0===e)return this.setState({action:f}),void clearInterval(this.interval);this.setState({waitTime:e-1})}),1e3)},this.redeemReward=()=>{this.gateway.get("/validator/rewardRequest/".concat(this.currentUser)).then((e=>{var t=e.data.result,r=this.props,a=r.DPoS,i=r.SGN,s=a.redeemedMiningReward,n=i.redeemedServiceReward;t.mining_reward!==l.a.values(s)[0].value||t.service_reward!==l.a.values(n)[0].value?this.contracts.SGN.methods.redeemReward.cacheSend("0x"+t.reward_request_proto_bytes):u.a.warn("You do not have more reward to redeem.")})).catch((e=>{console.error(e)}))},this.renderActions=()=>{var e=this.state,t=e.action,r=e.waitTime;switch(t){case S:return[Object(i.jsx)(w.a,{type:"primary",onClick:this.intendWithdraw,children:"Initialize Redeem"})];case x:return[Object(i.jsxs)(w.a,{disabled:!0,children:["Collecting signatures. ",r," seconds left"]})];case f:return[Object(i.jsx)(w.a,{type:"primary",onClick:this.redeemReward,children:"Redeem Reward"})]}};var r=e.accounts,a=e.network.setting;this.currentUser=r[0],this.contracts=t.drizzle.contracts,this.state={action:S},this.contracts.SGN.methods.redeemedServiceReward.cacheCall(this.currentUser),this.contracts.DPoS.methods.redeemedMiningReward.cacheCall(this.currentUser),this.gateway=R.a.create({baseURL:a.gateway,timeout:1e3}),this.gateway.get("/validator/reward/".concat(this.currentUser)).then((e=>{var t=e.data.result;this.setState({miningReward:t.mining_reward,serviceReward:t.service_reward})})).catch((e=>{console.error(e),e.response?u.a.error(e.response.data.error):u.a.warning("Please config gateway url in setting to load sgn reward correctly")}))}render(){var e=this.props,t=e.DPoS,r=e.SGN,a=this.state,s=a.miningReward,n=a.serviceReward,c=t.redeemedMiningReward,o=r.redeemedServiceReward;return l.a.isEmpty(o)||l.a.isEmpty(c)?Object(i.jsx)(v.a,{}):Object(i.jsx)(m.a,{title:"Reward",actions:this.renderActions(),children:Object(i.jsxs)(j.a,{style:{marginTop:"10px"},children:[Object(i.jsx)(p.a,{span:12,children:Object(i.jsx)(g.a,{title:"Cumulative Mining Reward",value:Object(O.a)(s,!0)})}),Object(i.jsx)(p.a,{span:12,children:Object(i.jsx)(g.a,{title:"Cumulative Service Reward",value:Object(O.a)(n,!0)})}),Object(i.jsx)(p.a,{span:12,children:Object(i.jsx)(g.a,{title:"Redeemed Mining Reward",value:Object(O.a)(l.a.values(c)[0].value,!0)})}),Object(i.jsx)(p.a,{span:12,children:Object(i.jsx)(g.a,{title:"Redeemed Service Reward",value:Object(O.a)(l.a.values(o)[0].value,!0)})})]})})}}y.contextTypes={drizzle:o.a.object},t.default=Object(h.drizzleConnect)(y,(function(e){var t=e.network,r=e.accounts,i=e.contracts,s=e.DPoS,n=e.SGN;return{network:t,accounts:r,DPoS:Object(a.a)(Object(a.a)({},s),i.DPoS),SGN:Object(a.a)(Object(a.a)({},n),i.SGN)}}))},927:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));r(65);var a=r(921),i=r.n(a),s=(r(160),(e,t)=>((e,t,r)=>{if(e)return r?"".concat(i.a.utils.fromWei(e)," ").concat(t):"".concat(i.a.utils.fromWei(e).split(".")[0]," ").concat(t)})(e,"CELR",t))},959:function(e,t){},960:function(e,t){},962:function(e,t){function r(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return[]},r.resolve=r,e.exports=r,r.id=962}}]);
//# sourceMappingURL=11.6a2bd58b.chunk.js.map
(this["webpackJsonpsgn-explorer"]=this["webpackJsonpsgn-explorer"]||[]).push([[9],{1131:function(e,t,a){"use strict";a.r(t);var r=a(34),i=a(0),s=a.n(i),n=a(1),c=a.n(n),d=a(53),o=a.n(d),l=a(96),w=a(1029),h=a(83),m=a(1135),u=a(1030),v=a(136),g=a(70),p=a(1028),R=a(1035),S=a.n(R),y=a(294);class E extends s.a.Component{constructor(e,t){super(e),this.intendWithdraw=()=>{this.gateway.post("/validator/withdrawReward",{eth_addr:this.currentUser}).then(()=>{w.a.success("Success! Please wait a few seconds to trigger redeem."),this.waitSigs()}).catch(e=>{console.error(e)})},this.waitSigs=()=>{this.setState({action:"wait",waitTime:30}),this.interval=setInterval(()=>{var e=this.state.waitTime;if(0===e)return this.setState({action:"redeem"}),void clearInterval(this.interval);this.setState({waitTime:e-1})},1e3)},this.redeemReward=()=>{this.gateway.get("/validator/rewardRequest/".concat(this.currentUser)).then(e=>{var t=e.data.result,a=this.props,r=a.DPoS,i=a.SGN,s=r.redeemedMiningReward,n=i.redeemedServiceReward;t.mining_reward!==o.a.values(s)[0].value||t.service_reward!==o.a.values(n)[0].value?this.contracts.SGN.methods.redeemReward.cacheSend("0x"+t.reward_request_proto_bytes):w.a.warn("You do not have more reward to redeem.")}).catch(e=>{console.error(e)})},this.renderActions=()=>{var e=this.state,t=e.action,a=e.waitTime;switch(t){case"init":return[s.a.createElement(h.a,{type:"primary",onClick:this.intendWithdraw},"Initialize Redeem")];case"wait":return[s.a.createElement(h.a,{disabled:!0},"Collecting signatures. ",a," seconds left")];case"redeem":return[s.a.createElement(h.a,{type:"primary",onClick:this.redeemReward},"Redeem Reward")]}};var a=e.accounts,r=e.network.setting;this.currentUser=a[0],this.contracts=t.drizzle.contracts,this.state={action:"init"},this.contracts.SGN.methods.redeemedServiceReward.cacheCall(this.currentUser),this.contracts.DPoS.methods.redeemedMiningReward.cacheCall(this.currentUser),this.gateway=S.a.create({baseURL:r.gateway,timeout:1e3}),this.gateway.get("/validator/reward/".concat(this.currentUser)).then(e=>{var t=e.data.result;this.setState({miningReward:t.mining_reward,serviceReward:t.service_reward})}).catch(e=>{console.error(e),e.response?w.a.error(e.response.data.error):w.a.warning("Please config gateway url in setting to load sgn reward correctly")})}render(){var e=this.props,t=e.DPoS,a=e.SGN,r=this.state,i=r.miningReward,n=r.serviceReward,c=t.redeemedMiningReward,d=a.redeemedServiceReward;return o.a.isEmpty(d)||o.a.isEmpty(c)?s.a.createElement(m.a,null):s.a.createElement(u.a,{title:"Reward",actions:this.renderActions()},s.a.createElement(v.a,{style:{marginTop:"10px"}},s.a.createElement(g.a,{span:12},s.a.createElement(p.a,{title:"Cumulative Mining Reward",value:Object(y.a)(i,!0)})),s.a.createElement(g.a,{span:12},s.a.createElement(p.a,{title:"Cumulative Service Reward",value:Object(y.a)(n,!0)})),s.a.createElement(g.a,{span:12},s.a.createElement(p.a,{title:"Redeemed Mining Reward",value:Object(y.a)(o.a.values(c)[0].value,!0)})),s.a.createElement(g.a,{span:12},s.a.createElement(p.a,{title:"Redeemed Service Reward",value:Object(y.a)(o.a.values(d)[0].value,!0)}))))}}E.contextTypes={drizzle:c.a.object},t.default=Object(l.drizzleConnect)(E,(function(e){var t=e.network,a=e.accounts,i=e.contracts,s=e.DPoS,n=e.SGN;return{network:t,accounts:a,DPoS:Object(r.a)(Object(r.a)({},s),i.DPoS),SGN:Object(r.a)(Object(r.a)({},n),i.SGN)}}))}}]);
//# sourceMappingURL=9.aece66f4.chunk.js.map
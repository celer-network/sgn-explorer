(this["webpackJsonpsgn-explorer"]=this["webpackJsonpsgn-explorer"]||[]).push([[11],{1133:function(e,t,a){"use strict";a.r(t);var r=a(30),s=a(13),i=a(0),n=a.n(i),c=a(1),d=a.n(c),o=a(55),l=a.n(o),h=a(98),w=a(1031),u=a(84),v=a(1138),j=a(1032),m=a(138),g=a(71),p=a(1030),b=a(1037),R=a.n(b),S=a(296),O="init",x="wait",y="redeem";class C extends n.a.Component{constructor(e,t){super(e),this.intendWithdraw=()=>{this.gateway.post("/validator/withdrawReward",{eth_addr:this.currentUser}).then((()=>{w.a.success("Success! Please wait a few seconds to trigger redeem."),this.waitSigs()})).catch((e=>{console.error(e)}))},this.waitSigs=()=>{this.setState({action:x,waitTime:30}),this.interval=setInterval((()=>{var e=this.state.waitTime;if(0===e)return this.setState({action:y}),void clearInterval(this.interval);this.setState({waitTime:e-1})}),1e3)},this.redeemReward=()=>{this.gateway.get("/validator/rewardRequest/".concat(this.currentUser)).then((e=>{var t=e.data.result,a=this.props,r=a.DPoS,s=a.SGN,i=r.redeemedMiningReward,n=s.redeemedServiceReward;t.mining_reward!==l.a.values(i)[0].value||t.service_reward!==l.a.values(n)[0].value?this.contracts.SGN.methods.redeemReward.cacheSend("0x"+t.reward_request_proto_bytes):w.a.warn("You do not have more reward to redeem.")})).catch((e=>{console.error(e)}))},this.renderActions=()=>{var e=this.state,t=e.action,a=e.waitTime;switch(t){case O:return[Object(s.jsx)(u.a,{type:"primary",onClick:this.intendWithdraw,children:"Initialize Redeem"})];case x:return[Object(s.jsxs)(u.a,{disabled:!0,children:["Collecting signatures. ",a," seconds left"]})];case y:return[Object(s.jsx)(u.a,{type:"primary",onClick:this.redeemReward,children:"Redeem Reward"})]}};var a=e.accounts,r=e.network.setting;this.currentUser=a[0],this.contracts=t.drizzle.contracts,this.state={action:O},this.contracts.SGN.methods.redeemedServiceReward.cacheCall(this.currentUser),this.contracts.DPoS.methods.redeemedMiningReward.cacheCall(this.currentUser),this.gateway=R.a.create({baseURL:r.gateway,timeout:1e3}),this.gateway.get("/validator/reward/".concat(this.currentUser)).then((e=>{var t=e.data.result;this.setState({miningReward:t.mining_reward,serviceReward:t.service_reward})})).catch((e=>{console.error(e),e.response?w.a.error(e.response.data.error):w.a.warning("Please config gateway url in setting to load sgn reward correctly")}))}render(){var e=this.props,t=e.DPoS,a=e.SGN,r=this.state,i=r.miningReward,n=r.serviceReward,c=t.redeemedMiningReward,d=a.redeemedServiceReward;return l.a.isEmpty(d)||l.a.isEmpty(c)?Object(s.jsx)(v.a,{}):Object(s.jsx)(j.a,{title:"Reward",actions:this.renderActions(),children:Object(s.jsxs)(m.a,{style:{marginTop:"10px"},children:[Object(s.jsx)(g.a,{span:12,children:Object(s.jsx)(p.a,{title:"Cumulative Mining Reward",value:Object(S.a)(i,!0)})}),Object(s.jsx)(g.a,{span:12,children:Object(s.jsx)(p.a,{title:"Cumulative Service Reward",value:Object(S.a)(n,!0)})}),Object(s.jsx)(g.a,{span:12,children:Object(s.jsx)(p.a,{title:"Redeemed Mining Reward",value:Object(S.a)(l.a.values(c)[0].value,!0)})}),Object(s.jsx)(g.a,{span:12,children:Object(s.jsx)(p.a,{title:"Redeemed Service Reward",value:Object(S.a)(l.a.values(d)[0].value,!0)})})]})})}}C.contextTypes={drizzle:d.a.object},t.default=Object(h.drizzleConnect)(C,(function(e){var t=e.network,a=e.accounts,s=e.contracts,i=e.DPoS,n=e.SGN;return{network:t,accounts:a,DPoS:Object(r.a)(Object(r.a)({},i),s.DPoS),SGN:Object(r.a)(Object(r.a)({},n),s.SGN)}}))}}]);
//# sourceMappingURL=11.45a4eb7b.chunk.js.map
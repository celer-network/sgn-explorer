(this["webpackJsonpsgn-explorer"]=this["webpackJsonpsgn-explorer"]||[]).push([[11],{1079:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a(82);var r=a(1078),n=a.n(r),s=(a(191),(e,t)=>((e,t,a)=>{if(e)return a?"".concat(n.a.utils.fromWei(e)," ").concat(t):"".concat(n.a.utils.fromWei(e).split(".")[0]," ").concat(t)})(e,"CELR",t))},1081:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n}));var r=2,n=Math.pow(10,r)},1086:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"d",(function(){return l}));var r,n=a(43),s=a(1081),c=(r="CELR",{formatter:e=>e?"".concat(e).concat(r):"",parser:e=>e.replace(/[A-Z]/g,"")}),i=e=>({validator:(t,a,r)=>{a<e&&r("value is smaller than ".concat(e));r()}}),o={name:"commissionRate",label:"Commission Rate",field:"number",fieldOptions:Object(n.a)(Object(n.a)({},{formatter:e=>e?"".concat(e,"%"):"",parser:e=>e.replace(/[%]/g,"")}),{},{placeholder:"The commission rate",step:1/s.a,precision:s.b}),rules:[i(0),{message:"Please enter a commission rate!",required:!0}]},l={name:"rateLockEndTime",label:"Rate Lock End Time",fieldOptions:{placeholder:"The rate lock end time",prefix:"+",suffix:"blocks"},rules:[{message:"Please enter a rate lock end time!",required:!0}]}},1120:function(e,t){},1128:function(e,t){},1165:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=1165},1177:function(e,t,a){"use strict";var r=a(0),n=a.n(r),s=a(4),c=a.n(s),i=a(1078),o=a.n(i),l=a(82),d=a.n(l),u=a(109),m=a(1058),h=a(1200),p=a(1248),v=a(1057),b=a(76),g=a(1061),w=a(1062),E=a(1344),f=a(1086),S=a(1079);a(1178);class R extends n.a.Component{constructor(e,t){super(e),this.onFinish=e=>{console.log(e);var t=this.props.CELRToken,a=d.a.values(t.allowance)[0]||{},r=e.stateNum;r>o.a.utils.fromWei(a.value)?(this.contracts.CELRToken.methods.approve(this.contracts.DPoS.address,o.a.utils.toWei(Number.MAX_SAFE_INTEGER.toString(),"ether")).send({}).on("receipt",e=>{this.sendDelegate(r)}),this.setState({approving:!0})):this.sendDelegate(r)},this.sendDelegate=e=>{var t=this.props,a=t.onClose,r=t.candidateId;this.contracts.DPoS.methods.delegate.cacheSend(r,o.a.utils.toWei(e.toString(),"ether")),this.setState({approving:!1}),a()},this.setMax=()=>{var e=this.props,t=e.accountBalances[e.account];this.formRef.current.setFieldsValue({stateNum:t})},this.formRef=n.a.createRef(),this.contracts=t.drizzle.contracts,this.state={approving:!1}}render(){var e=this.props,t=e.visible,a=e.onClose,r=e.accountBalances[e.account];return console.log(r,o.a.utils.toWei(r.toString(),"ether")),n.a.createElement(m.a,{title:"Delegate",className:"delegate-form",width:"25rem",visible:t,onCancel:a,footer:null},n.a.createElement(h.a,{spinning:this.state.approving,tip:"Approving CELR token..."},n.a.createElement(p.a,{ref:this.formRef,onFinish:this.onFinish,initialValues:{stateNum:1}},n.a.createElement("div",{className:"btn-group"},n.a.createElement(p.a.Item,{name:"stateNum",rules:[{message:"Please enter a value!",required:!0}]},n.a.createElement(v.a,f.a)),n.a.createElement(b.a,{block:!0,onClick:this.setMax},"max")),n.a.createElement(g.a,{gutter:16,className:"delegate-info"},n.a.createElement(w.a,{span:12},n.a.createElement(E.a,{title:"MIN Stake Amount",value:1})),n.a.createElement(w.a,{span:12},n.a.createElement(E.a,{title:"Available Amount",value:Object(S.a)(r)}))),n.a.createElement(p.a.Item,null,n.a.createElement(b.a,{type:"primary",htmlType:"submit",block:!0,style:{backgroundColor:"#2ED57B",color:"#000000",border:"1px solid #0AAD55",height:"3.625rem",fontSize:"1.125rem",borderRadius:"0.6rem",marginTop:"1.5rem"}},"Delegate")))))}}R.contextTypes={drizzle:c.a.object},t.a=Object(u.drizzleConnect)(R,(function(e){var t=e.contracts,a=e.accountBalances,r=e.accounts;return{CELRToken:t.CELRToken,accountBalances:a,account:r[0]}}))},1178:function(e,t,a){},1229:function(e,t,a){"use strict";var r=a(43),n=a(0),s=a.n(n),c=a(4),i=a.n(c),o=a(1078),l=a.n(o),d=a(1058),u=a(335),m=a(1086);class h extends s.a.Component{constructor(e,t){super(e),this.onSubmit=()=>{var e=this.props,t=e.onClose,a=e.candidate,r=a.args[0];this.form.current.validateFields((e,n)=>{if(!e){var s=n.value;"0"===a.value.status?this.contracts.DPoS.methods.withdrawFromUnbondedCandidate.cacheSend(r,l.a.utils.toWei(s.toString(),"ether")):this.contracts.DPoS.methods.intendWithdraw.cacheSend(r,l.a.utils.toWei(s.toString(),"ether")),t()}})},this.form=s.a.createRef(),this.contracts=t.drizzle.contracts}render(){var e=this.props,t=e.visible,a=e.onClose,n=[{name:"value",field:"number",fieldOptions:Object(r.a)(Object(r.a)({},m.a),{},{placeholder:"The amount of CELR to withdraw"}),rules:[{message:"Please enter a value!",required:!0}]}];return s.a.createElement(d.a,{title:"Withdraw Stake",visible:t,onOk:this.onSubmit,onCancel:a},s.a.createElement(u.a,{ref:this.form,items:n}))}}h.contextTypes={drizzle:i.a.object},t.a=h},1246:function(e,t,a){},1348:function(e,t,a){"use strict";a.r(t);var r=a(43),n=a(0),s=a.n(n),c=a(4),i=a.n(c),o=a(82),l=a.n(o),d=a(109),u=a(328),m=a(76),h=a(1340),p=a(1347),v=a(1061),b=a(1062),g=a(1344),w=a(1208),E=a.n(w),f=a(1079),S=a(1230),R=(a(1246),a(1177)),k=a(1229),C=a(1081);class O extends s.a.Component{constructor(e,t){super(e),this.contracts=t.drizzle.contracts;var a=this.props.candidateId;this.contracts.DPoS.methods.getDelegatorInfo.cacheCall(a,window.ethereum.selectedAddress)}render(){var e=this.props,t=e.stakeMethod,a=e.unBondMethod,r=e.DPoS,n=e.candidateId,c=l.a.values(r.getDelegatorInfo)[0],i=l.a.values(r.getCandidateInfo),o=l.a.find(i,e=>e.args[0]===n).value.commissionRate,d=c&&c.value.delegatedStake||"0",u=c&&c.value.undelegatingStake||"0";return"0"===d?null:s.a.createElement(b.a,{span:8,className:"block-col"},s.a.createElement(p.a,{className:"validator-card"},s.a.createElement(v.a,null,s.a.createElement(b.a,{span:12},"rate: ","".concat(o/C.a," %")),s.a.createElement(b.a,{span:12},"id: ",n),s.a.createElement(b.a,{span:6},"Your Stake"),s.a.createElement(b.a,{span:18},Object(f.a)(d)),s.a.createElement(b.a,{span:6},"Unbonded Stake"),s.a.createElement(b.a,{span:18},Object(f.a)(u)),s.a.createElement(b.a,{span:6},"Withdrawable"),s.a.createElement(b.a,{span:18},"--")),s.a.createElement(v.a,{justify:"space-between"},s.a.createElement(b.a,{span:7},s.a.createElement(m.a,{type:"primary",className:"extra-button btn-stake",onClick:t,block:!0},"Stake More")),s.a.createElement(b.a,{span:7},s.a.createElement(m.a,{type:"primary",className:"extra-button btn-unbond",onClick:a,block:!0},"Unbond")),s.a.createElement(b.a,{span:8},s.a.createElement(m.a,{block:!0,type:"primary",className:"extra-button btn-withdraw"},"withdraw")))))}}O.contextTypes={drizzle:i.a.object};var j=Object(d.drizzleConnect)(O,(function(e){var t=e.network,a=e.accounts,n=e.contracts,s=e.DPoS,c=e.SGN;return{network:t,accounts:a,DPoS:Object(r.a)(Object(r.a)({},s),n.DPoS),SGN:Object(r.a)(Object(r.a)({},c),n.SGN)}})),y=e=>{var t=Object(n.useState)(""),a=Object(S.a)(t,2),r=a[0],c=a[1],i=Object(n.useState)(null),o=Object(S.a)(i,2),l=o[0],d=o[1],u=Object(n.useState)(!1),m=Object(S.a)(u,2),h=m[0],b=m[1],g=Object(n.useState)(!1),w=Object(S.a)(g,2),E=w[0],f=w[1],C=()=>{f(!E)},O=()=>{b(!h)},y=e=>{c(e),C()},D=e=>{d(e),O()},N=e.candidates.map(e=>({candidateId:e.args[0]}));return s.a.createElement(p.a,{title:"My Delegations",className:"myDelegations"},s.a.createElement(v.a,null,N.map((e,t)=>s.a.createElement(j,Object.assign({key:t},e,{stakeMethod:y,unBondMethod:D})))),s.a.createElement(R.a,{candidateId:r,visible:E,onClose:C}),s.a.createElement(k.a,{candidate:l,visible:h,onClose:O}))};class D extends s.a.Component{constructor(e,t){super(e),this.intendWithdraw=()=>{this.gateway.post("/validator/withdrawReward",{eth_addr:this.currentUser}).then(()=>{u.b.success("Success! Please wait a few seconds to trigger redeem."),this.waitSigs()}).catch(e=>{console.error(e)})},this.waitSigs=()=>{this.setState({action:"wait",waitTime:30}),this.interval=setInterval(()=>{var e=this.state.waitTime;if(0===e)return this.setState({action:"redeem"}),void clearInterval(this.interval);this.setState({waitTime:e-1})},1e3)},this.redeemReward=()=>{this.gateway.get("/validator/rewardRequest/".concat(this.currentUser)).then(e=>{var t=e.data.result,a=this.props,r=a.DPoS,n=a.SGN,s=r.redeemedMiningReward,c=n.redeemedServiceReward;t.mining_reward!==l.a.values(s)[0].value||t.service_reward!==l.a.values(c)[0].value?this.contracts.SGN.methods.redeemReward.cacheSend("0x"+t.reward_request_proto_bytes):u.b.warn("You do not have more reward to redeem.")}).catch(e=>{console.error(e)})},this.renderActions=()=>{var e=this.state,t=e.action,a=e.waitTime;switch(t){case"init":return[s.a.createElement(m.a,{type:"primary",onClick:this.intendWithdraw},"Initialize Redeem")];case"wait":return[s.a.createElement(m.a,{disabled:!0},"Collecting signatures. ",a," seconds left")];case"redeem":return[s.a.createElement(m.a,{type:"primary",onClick:this.redeemReward},"Redeem Reward")]}};var a=e.accounts,r=e.network.setting;this.currentUser=a[0],this.contracts=t.drizzle.contracts,this.state={action:"init"},this.contracts.SGN.methods.redeemedServiceReward.cacheCall(this.currentUser),this.contracts.DPoS.methods.redeemedMiningReward.cacheCall(this.currentUser),this.gateway=E.a.create({baseURL:r.gateway,timeout:1e3}),this.gateway.get("/validator/reward/".concat(this.currentUser)).then(e=>{var t=e.data.result;this.setState({miningReward:t.mining_reward,serviceReward:t.service_reward})}).catch(e=>{console.error(e),e.response?u.b.error(e.response.data.error):u.b.warning("Please config gateway url in setting to load sgn reward correctly")})}render(){var e=this.props,t=e.DPoS,a=e.SGN,r=this.state,n=r.miningReward,c=r.serviceReward,i=t.redeemedMiningReward,o=a.redeemedServiceReward,d=l.a.values(t.getCandidateInfo);return l.a.isEmpty(o)||l.a.isEmpty(i)?s.a.createElement(h.a,null):s.a.createElement(s.a.Fragment,null,s.a.createElement(p.a,{title:"Reward",actions:this.renderActions()},s.a.createElement(v.a,{style:{marginTop:"10px"}},s.a.createElement(b.a,{span:12},s.a.createElement(g.a,{title:"Cumulative Mining Reward",value:Object(f.a)(n,!0)})),s.a.createElement(b.a,{span:12},s.a.createElement(g.a,{title:"Cumulative Service Reward",value:Object(f.a)(c,!0)})),s.a.createElement(b.a,{span:12},s.a.createElement(g.a,{title:"Redeemed Mining Reward",value:Object(f.a)(l.a.values(i)[0].value,!0)})),s.a.createElement(b.a,{span:12},s.a.createElement(g.a,{title:"Redeemed Service Reward",value:Object(f.a)(l.a.values(o)[0].value,!0)})))),s.a.createElement(y,{candidates:d}))}}D.contextTypes={drizzle:i.a.object};t.default=Object(d.drizzleConnect)(D,(function(e){var t=e.network,a=e.accounts,n=e.contracts,s=e.DPoS,c=e.SGN;return{network:t,accounts:a,DPoS:Object(r.a)(Object(r.a)({},s),n.DPoS),SGN:Object(r.a)(Object(r.a)({},c),n.SGN)}}))}}]);
//# sourceMappingURL=11.397c16dd.chunk.js.map